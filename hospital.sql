DROP TABLE IF EXISTS treatment CASCADE;

DROP TABLE IF EXISTS appointment CASCADE;

DROP TABLE IF EXISTS patient CASCADE;

DROP TABLE IF EXISTS doctor CASCADE;

DROP TABLE IF EXISTS specialty CASCADE;

CREATE TABLE specialty (
    spe_id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE doctor (
    doc_id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    surname VARCHAR(255) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(255),
    spe_id INTEGER NOT NULL REFERENCES specialty (spe_id)
);

CREATE TABLE patient (
    pat_id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    surname VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    gender CHAR(1),
    phone VARCHAR(20) NOT NULL,
    address VARCHAR(255) NOT NULL
);

CREATE TABLE appointment (
    app_id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    date DATE NOT NULL,
    time TIME NOT NULL,
    reason VARCHAR(255) NOT NULL,
    pat_id INTEGER NOT NULL REFERENCES patient (pat_id),
    doc_id INTEGER NOT NULL REFERENCES doctor (doc_id)
);

CREATE TABLE treatment (
    tre_id GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    description VARCHAR(500) NOT NULL,
    start_date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    end_date TIMESTAMP DEFAULT NULL,
    app_id INTEGER NOT NULL REFERENCES appointment (app_id)
);
